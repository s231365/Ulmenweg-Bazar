<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <!-- Bootstrap core CSS -->
        <link href="css/bootstrap.css" rel="stylesheet">
        <link href="css/custom.css" rel="stylesheet">
        <script src="js/bootstrap.bundle.js"></script>
        <script src="js/handlebars.min.js"></script>
        <script src="js/loadDataIntoStorage.js"></script>
        <title>Product View</title>
    </head>
    <body onload="loadDataFromJSON(); render_productsite();">

    <!--<script src="js/AddToCart.js"></script>-->

        <!-- Bootstrap core JS-->
        <script src="js/bootstrap.bundle.min.js"></script>
        <!-- Load Navbar script -->
        <script src="js/include-navbar-and-footer.js"></script>
        <!--load Navbar-->
        <div id="navbar-placeholder"></div>

        <section class="py-5 my-4">
            <div class="container px-4 px-lg-5 mt-5">
                <div class="title-box-featured">
                    <h2>Product Overview</h2>
                </div>

                <!--load products-->
                <ul id="product-list"></ul>

                <script> // Get the id parameter from the URL and load data from localStorage

                    // get the id given in the URL
                    const urlParams = new URLSearchParams(window.location.search);
                    const productId = urlParams.get('id');
                    console.log("found id: ", productId);

                    // get the string value from local storage and filter for a key
                    const all_data = JSON.parse(localStorage.getItem('products'));
                    const products = {};

                    for (const key in all_data.products) {
                        const element = all_data.products[key];
                        if (key === productId) { // Checking if the key is equal to productId
                            products[key] = element;
                        }
                    }
                    const filtered_data = {products: products}
                    console.log('Filtered data:', filtered_data);


                </script>

                <script id="product-template" type="text/x-handlebars-template">
                    <div class="row">
                        <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">
                            {{#each products}}

                                    <main class="container">
                                        <section class="py-5 my-4">
                                            <div class="row">
                                                <h2>{{this.title}}</h2>
                                            </div>
                                            <form class="row">
                                                <div class="col-8">
                                                    <img class="img-fluid" src="{{this.image}}" alt="Bazar Logo">
                                                </div>
                                                <div class="col-4 needs-validation">
                                                    <h3>Price</h3>
                                                    <button id="addToCartBtn" class="btn btn-primary w-100" type="submit" onclick="addToCart()">Add to
                                                        cart
                                                    </button>
                                                </div>
                                            </form>
                                            <div class="row">
                                                <h2>
                                                    price: {{this.price}}
                                                    description: {{this.description}}
                                                    categories: {{this.tags}}
                                                    condition: {{this.condition}}
                                                    shipping: {{this.shipping}}
                                                </h2>
                                            </div>
                                            <div class="row">
                                                <h2>Description</h2>
                                            </div>
                                        </section>
                                    </main>
                            {{/each}}
                        </div>
                    </div>
                </script>

                <script>
                    Handlebars.registerHelper('hasKey', function (product, key, options) {
                        console.log("inside helper", product[key]);
                        if (product[key]) {
                            return options.fn(this);
                        } else {
                            return options.inverse(this);
                        }
                    });

                    function render_productsite() {
                        const source = document.getElementById('product-template').innerHTML;
                        const template = Handlebars.compile(source);
                        console.log("all data: ", all_data);
                        console.log("filtered data: ", filtered_data);
                        const html = template(filtered_data);
                        console.log("html: ", html);
                        document.getElementById('product-list').innerHTML = html;
                    }


                </script>

            </div>
        </section>

        <!-- Footer-->
        <div id="footer-placeholder"></div>

    </body>
</html>