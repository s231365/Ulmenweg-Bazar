<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/custom.css" rel="stylesheet">
    <script src="js/bootstrap.bundle.js"></script>
    <script src="js/handlebars.min.js"></script>
    <script src="js/loadDataIntoStorage.js"></script>
    <script src="js/AddToCart.js"></script>
    <title>Product View</title>
</head>
<body onload="loadDataFromJSON(); render_productsite();">


<!-- Load Navbar script -->
<script src="js/include-navbar-and-footer.js"></script>
<!--load Navbar-->
<div id="navbar-placeholder"></div>

<section class="py-5 my-4 px-4 px-lg-5 mt-5">
    <div class="container">
        <!--load products-->
        <ul id="product-list"></ul>

        <script> // Get the id parameter from the URL and load data from localStorage

        // get the id given in the URL
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        console.log("found id: ", productId);

        // get the string value from local storage and filter for a key
        const all_data = JSON.parse(localStorage.getItem('products'));
        const products = {};

        for (const key in all_data.products) {
            const element = all_data.products[key];
            if (key === productId) { // Checking if the key is equal to productId
                products[key] = element;
            }
        }
        const filtered_data = {products: products}
        console.log('Filtered data:', filtered_data);


        </script>

        <script id="product-template" type="text/x-handlebars-template">
            {{#each products}}
                <div class="row">
                    <h2>{{this.title}}</h2>
                </div>

                <div class="row">
                    <div class="col-12 col-md-8 mb-4 mb-md-0">
                        <img class="img-fluid" src="{{this.image}}" alt="Product Image">
                    </div>
                <div class="col-12 col-md-4">
                    <div class="card my-4">
                        <div class="card-header">
                            <h3>Price {{this.price}} â‚¬</h3>
                        </div>
                        <div class="card-body">
                            <button id="addToCartBtn" class="btn btn-primary w-100"
                                    onclick="addToCart()">Add to Cart
                            </button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <h4>Description:</h4>
                            <p>{{this.description}}</p>
                            <h5>Categories:</h5>
                            <p>{{this.tags}}</p>
                            <h5>Condition:</h5>
                            <p>{{this.condition}}</p>
                            <h5>Shipping:</h5>
                            <p>{{this.shipping}}</p>
                        </div>
                    </div>

            {{/each}}

        </script>

        <script>
            Handlebars.registerHelper('hasKey', function (product, key, options) {
                console.log("inside helper", product[key]);
                if (product[key]) {
                    return options.fn(this);
                } else {
                    return options.inverse(this);
                }
            });

            function render_productsite() {
                const source = document.getElementById('product-template').innerHTML;
                const template = Handlebars.compile(source);
                console.log("all data: ", all_data);
                console.log("filtered data: ", filtered_data);
                const html = template(filtered_data);
                console.log("html: ", html);
                document.getElementById('product-list').innerHTML = html;
            }


        </script>

    </div>
</section>

<!-- Footer-->
<div id="footer-placeholder"></div>

</body>
</html>